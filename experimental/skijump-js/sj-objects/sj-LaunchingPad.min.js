SJ.LaunchingPad=class{constructor(){this.body=SJ.PadCreator.createPadBody(),Matter.World.add(SJ.world,this.body),this._img=SJ.PadCreator.padImg,this._parts=SJ.PadCreator.createPadParts(),this.restart()}restart(){this._isWaitingForLaunch=!0,this._isPullingJumper=!1,this._canJump=!1,this._pullingSystem=new SJ.PullingSystem}onReady(){SJ.MessagesManager.waitingForLaunch()}update(){this._isPullingJumper&&(this._pullingSystem.update()?this.setJumperVelocity():this.endOfPulling())}setJumperVelocity(){this._pullingSystem.setNewVelocityAndAngle()}launch(){this._isWaitingForLaunch=!1,this._isPullingJumper=!0,SJ.MessagesManager.skiingDown()}endOfPulling(){this._isPullingJumper=!1,this.setJumperDynamic(),this._canJump=!1,SJ.jumper.isFlying=!0,SJ.MessagesManager.isFlying()}setJumperDynamic(){SJ.jumper.letSteering()}startPullingJumper(){this._isPullingJumper=!0,this._pullingSystem.jumperFrictionMult=3,this._pullingSystem.pullingArray=SJ.V.padCollisionPoints;for(let i=0;i<SJ.V.padCollisionPoints.length;i++){const point=SJ.V.padCollisionPoints[i];if(point.x>=SJ.jumper.body.position.x)return this._pullingSystem.setIndex(i),void this.setJumperRightPosition()}}setJumperRightPosition(){const jumperRightPosition=this.getJumperRightPosition();Matter.Body.setPosition(SJ.jumper.body,jumperRightPosition)}getJumperRightPosition(){const jumperX=SJ.jumper.body.position.x,diffX=jumperX-this._pullingSystem.p1.x,pullingPointsDiffX=this._pullingSystem.p2.x-this._pullingSystem.p1.x,pullingPointsDiffY=this._pullingSystem.p2.y-this._pullingSystem.p1.y,k=diffX/pullingPointsDiffX,nextJumperY=this._pullingSystem.p1.y+pullingPointsDiffY*k,nextJumperPos=Matter.Vector.create(jumperX,nextJumperY);return Matter.Vector.add(nextJumperPos,SJ.jumper.offsetPoint)}draw(){push(),stroke(0),strokeWeight(4),fill(50,50,255,64),push(),translate(SJ.V.textureOffset.x,SJ.V.textureOffset.y),scale(SJ.V.padScale),image(this._img,0,0),pop(),this._drawPullingPoints(),this._drawCollisionBoxes(),pop()}_drawCollisionBoxes(){this.body.parts.forEach(part=>{beginShape(),part.vertices.forEach(element=>{vertex(element.x,element.y)}),endShape()})}_drawPullingPoints(){push(),fill(200,0,0),noStroke();const p=SJ.V.padPullingPoints[0];circle(p.x,p.y,10);for(let i=1;i<SJ.V.padPullingPoints.length;i++){const p1=SJ.V.padPullingPoints[i-1],p2=SJ.V.padPullingPoints[i];stroke(255),line(p1.x,p1.y,p2.x,p2.y),noStroke(),circle(p2.x,p2.y,10)}pop()}onKeyPressed(){keyCode==SPACE&&this.onSpaceHit()}onScreenTouched(){this.onSpaceHit()}onSpaceHit(){SJ.main._isRunning&&(this._canJump?(this.endOfPulling(),SJ.jumper.jump()):this._isWaitingForLaunch&&this.launch())}};